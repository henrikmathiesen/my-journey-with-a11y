<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ARIA - Tabs with arrow keys - My journey with a11y</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <script>
        // https://stackoverflow.com/questions/41142932/ie-supports-foreach-when-invoked-fromthe-console-but-not-when-called-from-t
        if (!Object.getOwnPropertyDescriptor(NodeList.prototype, 'forEach')) {
            Object.defineProperty(NodeList.prototype, 'forEach', Object.getOwnPropertyDescriptor(Array.prototype, 'forEach'));
        }
    
        // Added by moi
        if (!Object.getOwnPropertyDescriptor(NodeList.prototype, 'some')) {
            Object.defineProperty(NodeList.prototype, 'some', Object.getOwnPropertyDescriptor(Array.prototype, 'some'));
        }
    </script>
</head>

<body>
    <div class="container app-container">
        <header class="row app-header">
            <div class="col">
                <h1 class="pb-2 pt-2 pb-sm-4 pt-sm-4 pb-lg-5 pt-lg-5 text-center">
                    <a href="../../index.html">My journey with a11y</a>
                </h1>
            </div>
        </header>
        <main class="row py-2 py-sm-4 py-lg-5">
            
        <div class="col-lg-8">
            <div class="mb-5">
                <h2>ARIA - Tabs with arrow keys</h2>
            </div>

            <div>
                <div class="row" role="tablist" aria-label="A label that describes the purpose of the set of tabs">
                    <div class="col-4 col-lg-3">
                        <button id="tab-button-1" class="btn btn-link app-tab-button app-tab-button-active" role="tab" aria-selected="true" aria-controls="tab-1">TAB 1</button>
                    </div>
                    <div class="col-4 col-lg-3">
                        <button id="tab-button-2" class="btn btn-link app-tab-button" tabindex="-1" role="tab" aria-selected="false" aria-controls="tab-2">TAB 2</button>
                    </div>
                    <div class="col-4 col-lg-3">
                        <button id="tab-button-3" class="btn btn-link app-tab-button" tabindex="-1" role="tab" aria-selected="false" aria-controls="tab-3">TAB 3</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="app-tab-border"></div>
                    </div>
                </div>
                <div class="row my-4 px-4">
                    <div class="col-12">
                        <div id="tab-1" class="app-tab" role="tabpanel" aria-labelledby="tab-button-1">
                            <h3 tabindex="-1">TAB 1</h3>
                            <p>
                                Lorem ipsum dolor sit amet consectetur, adipisicing elit. Provident, delectus cumque voluptatum quae, magnam fugiat debitis exercitationem ipsa mollitia esse eos assumenda rem cum officiis sint ipsam veritatis in commodi.
                            </p>
                            <div>
                                <button class="btn btn-primary">A place of focus in TAB 1</button>
                            </div>
                        </div>
                        <div id="tab-2" class="d-none app-tab" role="tabpanel" aria-labelledby="tab-button-2">
                            <h3 tabindex="-1">TAB 2</h3>
                            <p>
                                Lorem ipsum dolor sit amet consectetur, adipisicing elit. Provident, delectus cumque voluptatum quae, magnam fugiat debitis exercitationem ipsa mollitia esse eos assumenda rem cum officiis sint ipsam veritatis in commodi.
                            </p>
                            <div>
                                <button class="btn btn-primary">A place of focus in TAB 2</button>
                            </div>
                        </div>
                        <div id="tab-3" class="d-none app-tab" role="tabpanel" aria-labelledby="tab-button-3">
                            <h3 tabindex="-1">TAB 3</h3>
                            <p>
                                Lorem ipsum dolor sit amet consectetur, adipisicing elit. Provident, delectus cumque voluptatum quae, magnam fugiat debitis exercitationem ipsa mollitia esse eos assumenda rem cum officiis sint ipsam veritatis in commodi.
                            </p>
                            <div>
                                <button class="btn btn-primary">A place of focus in TAB 3</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <div class="app-tab-border"></div>
                    </div>
                </div>
            </div>

        </div>

        <script>
            const KEY_LEFT = 37;
            const KEY_RIGHT = 39;
            let activeTabButtonIndex = 0;

            const $tabButtons = document.querySelectorAll('.app-tab-button');
            const $tabs = document.querySelectorAll('.app-tab');

            function onTabButtonClick(ev) {

                // Reset tab buttons and set state for the one clicked
                $tabButtons.forEach(button => {
                    button.classList.remove('app-tab-button-active');
                    button.setAttribute('aria-selected', 'false');
                });
                ev.target.classList.add('app-tab-button-active');
                ev.target.setAttribute('aria-selected', 'true');

                // Reset tabs and set state for the one active
                $tabs.forEach(tab => tab.classList.add('d-none'));
                const idForActiveTab = ev.target.getAttribute('aria-controls');
                const $activeTab = document.getElementById(idForActiveTab);
                $activeTab.classList.remove('d-none');
            }

            function onKeyup(e) {
                if (e.keyCode === KEY_LEFT || e.keyCode === KEY_RIGHT) {
                    const aTabHasFocus = $tabButtons.some(elementHasFocus);

                    if (aTabHasFocus === false) {
                        return;
                    }

                    $tabButtons[activeTabButtonIndex].setAttribute('tabindex', '-1');

                    if (e.keyCode === KEY_LEFT) {
                        if (activeTabButtonIndex === 0) {
                            activeTabButtonIndex = $tabButtons.length - 1;
                        } else {
                            activeTabButtonIndex = activeTabButtonIndex - 1;
                        }
                    }

                    if (e.keyCode === KEY_RIGHT) {
                        if (activeTabButtonIndex === $tabButtons.length - 1) {
                            activeTabButtonIndex = 0;
                        } else {
                            activeTabButtonIndex = activeTabButtonIndex + 1;
                        }
                    }

                    $tabButtons[activeTabButtonIndex].removeAttribute('tabindex');
                    $tabButtons[activeTabButtonIndex].focus();
                }
            }

            function elementHasFocus(element) {
                return document.activeElement === element && document.hasFocus();
            }

            $tabButtons.forEach(button => button.addEventListener('click', onTabButtonClick));
            window.addEventListener('keyup', onKeyup);
        </script>


        </main>
    </div>
</body>

</html>
